<?xml version="1.0" encoding="UTF-8" ?>
<query>
<GET_COMM_CODE>
  select CODE_ID, CODE_NM from comm_code where GROUP_ID = ?
</GET_COMM_CODE>

<GET_COMM_PRODUCT_LIST>
  select PRODUCT_ID, PRODUCT_NM from esupply.product_master where CLASS_ID = ? 
</GET_COMM_PRODUCT_LIST>

<!-- ==============================================================================================
  제품관리
=============================================================================================== -->
<GET_PRODUCT_CNT>
  SELECT COUNT(*) as cnt 
    from esupply.product_master 
   where class_id = ? 
     and product_id = ?
</GET_PRODUCT_CNT>
<DEL_PRODUCT>
  DELETE FROM esupply.product_master 
   where class_id = ? 
     and product_id = ? 
</DEL_PRODUCT>
<GET_CHECK_SEQUENCE>
  SELECT count(*) as cnt FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ?
</GET_CHECK_SEQUENCE>
<ADD_PRODUCT>
  INSERT INTO esupply.product_master (class_id, product_id, product_nm, price, weight, size_h, size_v, size_z, image)
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
</ADD_PRODUCT>
<ADD_GOOD>
  insert into GOOD (CLASS_ID, PRODUCT_ID, SERIAL_NO, MANUFACTURING_DTTM, LOT_NO)
  VALUES ( ?, ?, concat(? , ?), DATE_FORMAT(CURRENT_TIMESTAMP(), '%Y%m%d%H%i%s'), ? )
</ADD_GOOD>
<GET_INVENTORY>
  SELECT COUNT(*) as cnt FROM good_inventory WHERE CLASS_ID = ? AND PRODUCT_ID = ?
</GET_INVENTORY>
<ADD_INVENTORY>
  insert into good_inventory (CLASS_ID, PRODUCT_ID, COUNT) VALUES (?, ?, ?)
</ADD_INVENTORY>
<UPD_INVENTORY>
  update good_inventory set COUNT = COUNT + ? where CLASS_ID = ? and PRODUCT_ID  = ?
</UPD_INVENTORY>
<GET_GOOD_LIST>
  select mst.CLASS_ID , mst.PRODUCT_ID, mst.PRODUCT_NM, mst.PRICE, mst.WEIGHT, mst.SIZE_H, mst.SIZE_V, mst.SIZE_Z 
       , ifnull(inv.COUNT , 0) as COUNT
       , cf.STORE_NM as IMAGE
    from esupply.product_master mst
    left join esupply.good_inventory inv on mst.CLASS_ID = inv.CLASS_ID and mst.PRODUCT_ID = inv.PRODUCT_ID
    left join esupply.comm_files cf on mst.IMAGE = cf.FILE_ID and cf.TABLE_NM = 'product_master' 
</GET_GOOD_LIST>
<!-- ========================================================================================== -->



<!-- ==============================================================================================
  상품목록 조회(상품관리자용)
=============================================================================================== -->
<GET_GOOD_LIST_ADMIN>
  SELECT pm.CLASS_ID 
       , pm.PRODUCT_ID 
       , pm.PRODUCT_NM 
       , g.MANUFACTURING_DTTM 
       , g.LOT_NO 
       , g.SERIAL_NO 
    FROM esupply.product_master pm
   INNER JOIN esupply.good g ON pm.CLASS_ID = g.CLASS_ID AND pm.PRODUCT_ID = g.PRODUCT_ID 
   WHERE 1 = 1
</GET_GOOD_LIST_ADMIN>
<GET_GOOD_LIST_NM>
  AND pm.PRODUCT_NM LIKE CONCAT('%', ?, '%')
</GET_GOOD_LIST_NM>
<GET_GOOD_LIST_DTTM>
  AND g.MANUFACTURING_DTTM LIKE CONCAT(?, '%')
</GET_GOOD_LIST_DTTM>
<GET_GOOD_LIST_LOT>
  AND g.LOT_NO = ?
</GET_GOOD_LIST_LOT>
<GET_GOOD_LIST_SERIAL>
  AND g.SERIAL_NO = ?
</GET_GOOD_LIST_SERIAL>
<GET_GOOD_LIST_ORDER>
  ORDER BY pm.CLASS_ID , pm.PRODUCT_NM , g.MANUFACTURING_DTTM
</GET_GOOD_LIST_ORDER>
<!-- ========================================================================================== -->
<DEL_GOOD>
  DELETE FROM esupply.good WHERE SERIAL_NO = ?
</DEL_GOOD>
<UPD_INVENTORY_UP>
  UPDATE esupply.good_inventory
     SET COUNT = COUNT + 1
   WHERE CLASS_ID = ?
     AND PRODUCT_ID = ?
</UPD_INVENTORY_UP>
<UPD_INVENTORY_DN>
  UPDATE esupply.good_inventory
     SET COUNT = COUNT - 1
   WHERE CLASS_ID = ?
     AND PRODUCT_ID = ?
</UPD_INVENTORY_DN>
<!-- ========================================================================================== -->

<!-- ==============================================================================================
  부품목록 조회
=============================================================================================== -->
<GET_PRODUCT_PART_LIST>
SELECT ppl.PART_NO
     , pm.PART_NM 
     , pm.PRICE
	   , pm.WEIGHT
	   , pm.SIZE_H
	   , pm.SIZE_V
	   , pm.SIZE_Z
	   , ppl.COUNT 
  FROM esupply.product_part_list ppl
 INNER JOIN esupply.part_master pm on ppl.PART_NO = pm.PART_NO 
 WHERE ppl.PRODUCT_ID = 'CAP_001_CERA_DW467823'
 ORDER BY ppl.PART_NO
</GET_PRODUCT_PART_LIST>

<!-- ========================================================================================== --> 
</query>